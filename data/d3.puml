@startuml
!theme plain

' Global dark theme
skinparam backgroundColor #000000
skinparam defaultFontColor #FFFFFF

' Notes
skinparam note {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
}

' Actors
skinparam actorStyle awesome
skinparam actor {
  StereotypeFontColor #FFFFFF
  FontColor #FFFFFF
}

' Sequence styling
skinparam sequence {
  LifeLineBorderColor #FFFFFF
  LifeLineBackgroundColor #000000
  ParticipantBorderColor #FFFFFF
  DividerBackgroundColor #000000
  DividerBorderColor #FFFFFF
  DividerFontColor #FFFFFF
}

' Colors
!$PEER_A_COLOR       = "#87CEEB"
!$PEER_B_COLOR       = "#FFB6C1"
!$MASTER_PEER_COLOR  = "#90EE90"
!$SYSTEM_COLOR       = "#FFFFFF"

actor "PeerA" as PA $PEER_A_COLOR
actor "PeerB" as PB $PEER_B_COLOR

title Diagram 4: Session Rekey Flow

autonumber

== Rekey Initiation ==
PA -[$PEER_A_COLOR]> PB: REKEY_PROPOSE(New_Kyber_CT)
activate PB $PEER_B_COLOR
note right PB: Decapsulate\nGenerate new AEAD keys

PB -[$PEER_B_COLOR]> PA: REKEY_ACK
note left PA: Confirm key install

== Post-Rekey Data ==
PA -[$PEER_A_COLOR]> PB: ENC_MSG[1]


PB -[$PEER_B_COLOR]> PA: ENC_REPLY[1]


deactivate PB

footer ""
@enduml