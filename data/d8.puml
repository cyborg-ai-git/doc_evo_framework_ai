@startuml
!theme plain

' Colour constants
!define PEER_B_COLOR      #FFB6C1
!define MASTER_PEER_COLOR #90EE90
!define MEMORY_COLOR      #fbff00
!define SYSTEM_COLOR      #FFFFFF

' Global styling
skinparam backgroundColor #000000
skinparam defaultFontColor #FFFFFF
skinparam actorStyle awesome
skinparam database {
  BackgroundColor MEMORY_COLOR
  BorderColor MEMORY_COLOR
  FontColor #000000
}
skinparam note {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
}

' Sequence styling
skinparam sequence {
  LifeLineBorderColor #FFFFFF
  LifeLineBackgroundColor #000000
  ParticipantBorderColor #FFFFFF
  DividerBackgroundColor #000000
  DividerBorderColor #FFFFFF
  DividerFontColor #FFFFFF
}

' Participants
actor      "PeerB"      as PB PEER_B_COLOR
actor      "MasterPeer" as MP MASTER_PEER_COLOR
database   "CertDB"     as DB MEMORY_COLOR

title Diagram 5: Certificate Retrieval Protocol
autonumber

== Request Phase ==
PB -[PEER_B_COLOR]> MP: ENC_QUERY(ID_A)
activate MP
note right MP: KEM decapsulation\nAEAD decryption

== Validation & Lookup ==
MP -> MP: Verify query authorization
MP -[MASTER_PEER_COLOR]> DB: GET_CERT(ID_A)
activate DB
DB --[SYSTEM_COLOR]> MP: Certificate Data
deactivate DB

MP -> MP: Sign response with Dilithium
note left MP: Include revocation status

== Delivery Phase ==
MP -[MASTER_PEER_COLOR]> PB: ENC_CERT_RESPONSE
note left PB: Decrypt & verify chain
deactivate MP

@enduml