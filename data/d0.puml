@startuml
!theme plain

' Global dark theme
skinparam backgroundColor #000000
skinparam defaultFontColor #FFFFFF

' Notes
skinparam note {
BackgroundColor #FFFFFF
BorderColor #000000
FontColor #000000
}

' Actors
skinparam actorStyle awesome
skinparam actor {
StereotypeFontColor #FFFFFF
FontColor #FFFFFF
}

' Sequence styling
skinparam sequence {
LifeLineBorderColor #FFFFFF
LifeLineBackgroundColor #000000
ParticipantBorderColor #FFFFFF
DividerBackgroundColor #000000
DividerBorderColor #FFFFFF
DividerFontColor #FFFFFF
}

' Colors
!$PEER_A_COLOR    = "#87CEEB"
!$PEER_B_COLOR    = "#FFB6C1"
!$MASTER_PEER_COLOR = "#90EE90"
!$SYSTEM_COLOR    = "#FFFFFF"

actor "PeerB" as PB $PEER_B_COLOR
actor "PeerA" as PA $PEER_A_COLOR

title Diagram 2: Direct Communication (Cert Already Installed)

autonumber

== Session Establishment ==
PB -[$PEER_B_COLOR]> PA: AKE_REQUEST(Kyber_CT)
activate PA $PEER_A_COLOR
note right PA: 1. Decapsulate Kyber\n2. Derive shared key

PA -[$PEER_A_COLOR]> PB: SESSION_CONFIRM
note left PB: Verify Initialize AEAD

== Data Exchange ==
PB -[$PEER_B_COLOR]> PA: ENC_PAYLOAD[0]
note right PB: ChaCha20-Poly1305

PA -[$PEER_A_COLOR]> PB: ENC_RESPONSE[0]
note left PA: Rate limiting

deactivate PA

footer ""
@enduml